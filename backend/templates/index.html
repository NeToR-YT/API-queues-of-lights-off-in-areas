<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç API –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #007bff;
            margin-top: 0;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        input, select, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }
        button:hover {
            background-color: #0056b3;
        }
        .response {
            background-color: #f9f9f9;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .response pre {
            margin: 0;
            font-size: 12px;
            color: #333;
        }
        .error {
            border-left-color: #dc3545;
            background-color: #fff5f5;
            color: #721c24;
        }
        .success {
            border-left-color: #28a745;
            background-color: #f5fff5;
            color: #155724;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>üîå –¢–µ—Å—Ç API –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</h1>
    
    <div class="grid-2">
        <!-- –¢–µ—Å—Ç /api/cities -->
        <div class="test-section">
            <h2>1. GET /api/cities</h2>
            <p>–û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –º—ñ—Å—Ç</p>
            <div class="controls">
                <button onclick="testCities()">–í–∏–∫–æ–Ω–∞—Ç–∏</button>
            </div>
            <div id="cities-response"></div>
        </div>

        <!-- –¢–µ—Å—Ç /api/schedules -->
        <div class="test-section">
            <h2>2. GET /api/schedules</h2>
            <p>–û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥ –ø–æ –º—ñ—Å—Ç–∞–º —Ç–∞ –¥–∞—Ç–∞–º</p>
            <div class="controls">
                <input type="number" id="schedules-city" placeholder="City ID" value="1" min="1">
                <input type="date" id="schedules-date" placeholder="–î–∞—Ç–∞">
                <input type="text" id="schedules-queue" placeholder="–ß–µ—Ä–≥–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)">
                <button onclick="testSchedules()">–í–∏–∫–æ–Ω–∞—Ç–∏</button>
            </div>
            <div id="schedules-response"></div>
        </div>

        <!-- –¢–µ—Å—Ç /api/schedules/today -->
        <div class="test-section">
            <h2>3. GET /api/schedules/today</h2>
            <p>–†–æ–∑–∫–ª–∞–¥ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</p>
            <div class="controls">
                <input type="number" id="today-city" placeholder="City ID" value="1" min="1">
                <input type="text" id="today-queue" placeholder="–ß–µ—Ä–≥–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)">
                <button onclick="testSchedulesToday()">–í–∏–∫–æ–Ω–∞—Ç–∏</button>
            </div>
            <div id="today-response"></div>
        </div>

        <!-- –¢–µ—Å—Ç –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö -->
        <div class="test-section">
            <h2>4. –®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç</h2>
            <p>–í–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å—ñ —Ç–µ—Å—Ç–∏ —Ä–∞–∑–æ–º</p>
            <div class="controls">
                <button onclick="testAll()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Å–µ</button>
            </div>
            <div id="all-response"></div>
        </div>
    </div>

    <script>
        function formatDate(date) {
            if (!date) return new Date().toISOString().split('T')[0];
            return date;
        }

        function displayResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'response error' : 'response success';
            element.innerHTML = `<div class="${className}"><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
        }

        async function testCities() {
            try {
                const response = await fetch('/api/cities');
                const data = await response.json();
                displayResponse('cities-response', data, false);
            } catch (error) {
                displayResponse('cities-response', { error: error.message }, true);
            }
        }

        async function testSchedules() {
            try {
                const cityId = document.getElementById('schedules-city').value;
                const date = document.getElementById('schedules-date').value || formatDate();
                const queue = document.getElementById('schedules-queue').value;

                let url = `/api/schedules?city_id=${cityId}&date=${date}`;
                if (queue) url += `&queue=${queue}`;

                const response = await fetch(url);
                const data = await response.json();
                
                if (!response.ok) {
                    displayResponse('schedules-response', data, true);
                } else {
                    displayResponse('schedules-response', data, false);
                }
            } catch (error) {
                displayResponse('schedules-response', { error: error.message }, true);
            }
        }

        async function testSchedulesToday() {
            try {
                const cityId = document.getElementById('today-city').value;
                const queue = document.getElementById('today-queue').value;

                let url = `/api/schedules/today?city_id=${cityId}`;
                if (queue) url += `&queue=${queue}`;

                const response = await fetch(url);
                const data = await response.json();
                
                if (!response.ok) {
                    displayResponse('today-response', data, true);
                } else {
                    displayResponse('today-response', data, false);
                }
            } catch (error) {
                displayResponse('today-response', { error: error.message }, true);
            }
        }

        async function testAll() {
            const element = document.getElementById('all-response');
            element.innerHTML = '<div class="response"><pre>–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</pre></div>';

            const results = {};

            try {
                // –¢–µ—Å—Ç 1: Cities
                const citiesResp = await fetch('/api/cities');
                results.cities = await citiesResp.json();

                // –¢–µ—Å—Ç 2: Schedules
                const schedulesResp = await fetch('/api/schedules?city_id=1&date=' + formatDate());
                results.schedules = await schedulesResp.json();

                // –¢–µ—Å—Ç 3: Today
                const todayResp = await fetch('/api/schedules/today?city_id=1');
                results.today = await todayResp.json();

                displayResponse('all-response', results, false);
            } catch (error) {
                displayResponse('all-response', { error: error.message }, true);
            }
        }

        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω—É –¥–∞—Ç—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('schedules-date').value = formatDate();
        });
    </script>
</body>
</html>